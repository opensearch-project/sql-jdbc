lib = library(identifier: 'jenkins@1.5.3', retriever: modernSCM([
    $class: 'GitSCMSource',
    remote: 'https://github.com/opensearch-project/opensearch-build-libraries.git',
]))

standardReleasePipelineWithGenericTrigger(
    overrideDockerImage: 'opensearchstaging/ci-runner:release-centos7-clients-v4',
    tokenIdCredential: 'jenkins-sql-jdbc-generic-webhook-token',
    causeString: 'A tag was cut on opensearch-project/sql-jdbc repository causing this workflow to run',
    downloadReleaseAsset: true,
    publishRelease: true) {
        publishToMaven(
            signingArtifactsPath: "$WORKSPACE/repository/",
            mavenArtifactsPath: "$WORKSPACE/repository/",
            autoPublish: true
        )
        publishToArtifactsProdBucket(
            assumedRoleName: 'sql-jdbc-upload-role',
            source: "$WORKSPACE/artifacts.tar.gz",
            destination: "https://artifacts.opensearch.org/opensearch-clients/jdbc/opensearch-sql-jdbc-${tag}.tar.gz",
            signingPlatform: 'linux',
            sigOverwrite: true
        )
        publishToArtifactsProdBucket(
            assumedRoleName: 'sql-jdbc-shadowJar-upload-role',
            source: "$WORKSPACE/opensearch-sql-jdbc-shadow-*.jar",
            destination: "https://artifacts.opensearch.org/opensearch-clients/jdbc/opensearch-sql-jdbc-shadow-${tag}.jar",
            signingPlatform: 'linux',
            sigOverwrite: true
        )
    }
